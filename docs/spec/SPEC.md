# Hoops 기능 스펙 명세서

> 최종 수정일: 2026-01-13
> 버전: 1.0
> 상태: Confirmed

---

## 1. 개요

이 문서는 Hoops MVP의 상세 기능 스펙을 정의합니다.
PRD에서 정의한 범위를 기반으로, 기술적 구현과 비즈니스 규칙을 명확히 합니다.

**관련 문서**:
- [PRD](../prd.md) - 문제 정의, 타겟 사용자
- [MVP 기능 목록](./mvp-features.md) - 구현 현황
- [아키텍처](../architecture/architecture.md) - 기술 구조

---

## 2. 핵심 비즈니스 규칙

### 2.1 참가 승인 정책

| 항목 | 설정 | 이유 |
|------|------|------|
| 승인 방식 | **호스트 승인** | 노쇼/비매너 방지를 위한 신뢰도 관리 |
| 자동 승인 | 미지원 (Phase 2 검토) | UX vs 신뢰도 트레이드오프 |

**호스트 승인 플로우**:
```
참가자 신청 → PENDING 상태 → 호스트 승인/거절 → CONFIRMED/REJECTED
```

### 2.2 취소 정책

| 주체 | 제한 시간 | 추가 조건 |
|------|----------|----------|
| 호스트 (경기 취소) | 경기 시작 **2시간 전**까지 | 취소 사유 필수 입력 |
| 참가자 (참가 취소) | 경기 시작 **2시간 전**까지 | - |

**취소 시 처리**:
- 승인된 모든 참가자에게 알림 발송
- 취소 사유가 알림에 포함됨
- 취소된 경기는 1시간 이내 복구 가능 (기존 기능)

### 2.3 인원 제한

| 항목 | 값 | 비고 |
|------|-----|------|
| 최소 인원 | **4명** | 농구 경기 최소 인원 |
| 최대 인원 | **20명** | 과대 경기 방지 |

### 2.4 경기 일정 제한

| 항목 | 값 | 비고 |
|------|-----|------|
| 최소 시작 시간 | 현재 시간 + **1시간** | 모집 시간 확보 |
| 최대 예약 기간 | **14일** (2주) | 너무 먼 미래 경기 방지 |

### 2.5 중복 참가/호스팅 제한

| 규칙 | 설명 |
|------|------|
| 참가자 | **시간이 겹치는 경기**에 중복 참가 불가 |
| 호스트 | **시간이 겹치는 경기** 중복 생성 불가 |

**시간 겹침 판정**:
```
기존 경기: startTime1 ~ endTime1
신규 경기: startTime2 ~ endTime2

겹침 조건: startTime1 < endTime2 AND startTime2 < endTime1
```

### 2.6 동시성 처리

| 상황 | 처리 방식 |
|------|----------|
| 정원 마감 시점 동시 신청 | **선착순 확정** |
| 구현 방식 | 낙관적 락 (@Version) + 3회 재시도 |
| 실패 시 | "정원이 마감되었습니다" 메시지 |

---

## 3. 경기 (Match) 상세 스펙

### 3.1 경기 생성

**필수 입력**:
| 필드 | 타입 | 제약 조건 |
|------|------|----------|
| title | String | 2-50자 |
| description | String | 최대 500자 (선택) |
| locationId | Long | 등록된 장소 필수 |
| matchDate | LocalDate | 오늘 ~ 14일 이내 |
| startTime | LocalTime | 현재+1시간 이후 |
| endTime | LocalTime | startTime 이후 |
| maxParticipants | Integer | 4-20명 |

**생성 시 검증**:
1. 호스트가 같은 시간대에 다른 경기를 주최하고 있지 않은지
2. matchDate + startTime이 현재 시간 + 1시간 이후인지
3. matchDate가 오늘로부터 14일 이내인지
4. endTime > startTime인지

### 3.2 경기 수정

**수정 가능 항목**:
| 필드 | 수정 가능 | 비고 |
|------|----------|------|
| title | O | 언제든 수정 가능 |
| description | O | 언제든 수정 가능 |
| locationId | **X** | 장소 변경 불가 |
| matchDate | **X** | 날짜 변경 불가 |
| startTime | **X** | 시간 변경 불가 |
| endTime | **X** | 시간 변경 불가 |
| maxParticipants | **X** | 정원 변경 불가 |

**수정 제한 이유**: 핵심 정보(장소, 시간, 정원) 변경은 참가자에게 큰 영향을 미침

### 3.3 경기 상태

| 상태 | 설명 | 전이 조건 |
|------|------|----------|
| PENDING | 모집 중 | 생성 시 |
| IN_PROGRESS | 진행 중 | startTime 도달 시 (스케줄러) |
| ENDED | 종료됨 | endTime 도달 시 (스케줄러) |
| CANCELLED | 취소됨 | 호스트가 취소 시 |

### 3.4 종료된 경기 표시

| 설정 | 값 |
|------|-----|
| 메인 목록 표시 | 종료 후 **7일**까지 |
| 마이페이지 표시 | **무기한** (히스토리 보관) |

---

## 4. 참가 (Participation) 상세 스펙

### 4.1 참가 상태

| 상태 | 설명 |
|------|------|
| PENDING | 신청됨, 호스트 승인 대기 |
| CONFIRMED | 승인됨, 참가 확정 |
| CANCELLED | 취소됨 (참가자 또는 호스트) |
| REJECTED | 거절됨 (호스트) |

### 4.2 참가 신청 검증

```
1. 로그인 여부 확인
2. 경기 상태가 PENDING인지 확인
3. 호스트 본인이 아닌지 확인
4. 이미 신청하지 않았는지 확인 (중복 방지)
5. 정원 초과 여부 확인 (CONFIRMED 기준)
6. 같은 시간대 다른 경기 참가 여부 확인
```

### 4.3 참가 취소 검증

```
1. 본인 확인
2. 참가 상태가 PENDING 또는 CONFIRMED인지 확인
3. 경기 시작 2시간 전인지 확인
```

### 4.4 참가자 정보 표시

경기 상세 페이지에서 참가자 목록 표시:

| 표시 항목 | 비고 |
|----------|------|
| 닉네임 | 필수 |
| 평점 | 기본값 4.5 (Phase 2에서 실제 평점 반영) |

---

## 5. 장소 (Location) 상세 스펙

### 5.1 장소 등록

**필수 입력**:
| 필드 | 타입 | 설명 |
|------|------|------|
| name | String | 장소명 |
| address | String | 주소 |
| latitude | Double | 위도 |
| longitude | Double | 경도 |

**선택 입력**: 없음 (MVP에서는 최소 정보만)

### 5.2 장소 검색

- 카카오 Places API 연동
- 키워드 검색 지원
- 검색 결과에서 선택하여 등록

---

## 6. 사용자 (User) 상세 스펙

### 6.1 프로필 정보

| 필드 | 타입 | 수정 가능 | 비고 |
|------|------|----------|------|
| nickname | String | **O** | 2-20자 |
| email | String | X | 카카오에서 가져옴 |
| profileImage | String | **O** | 이미지 URL |
| bio | String | **O** | 한 줄 소개 (최대 100자) |
| rating | BigDecimal | X | 기본값 4.5 (Phase 2) |
| matchCount | Integer | X | 자동 계산 |

### 6.2 마이페이지 구성

```
마이페이지
├── 프로필 섹션
│   ├── 프로필 사진
│   ├── 닉네임
│   ├── 한 줄 소개
│   └── 프로필 수정 버튼
│
├── 내 경기 섹션 (탭)
│   ├── [예정] 참가 예정 경기
│   └── [완료] 지난 경기
│
└── 알림 메뉴 (별도 페이지 이동)
```

---

## 7. 알림 (Notification) 상세 스펙

### 7.1 알림 이벤트

| 이벤트 | 수신자 | 내용 |
|--------|--------|------|
| 새 참가 신청 | 호스트 | "OOO님이 'XXX' 경기에 참가 신청했습니다" |
| 참가 승인 | 참가자 | "OOO 경기 참가가 승인되었습니다" |
| 참가 거절 | 참가자 | "OOO 경기 참가가 거절되었습니다" |
| 참가 취소 | 호스트 | "OOO님이 'XXX' 경기 참가를 취소했습니다" |
| 경기 취소 | 참가자 전원 | "OOO 경기가 취소되었습니다. 사유: XXX" |
| 경기 임박 | 참가자 전원 | "OOO 경기가 1시간 후 시작됩니다" (Phase 2) |

### 7.2 알림 관리 기능

| 기능 | MVP | Phase 2 |
|------|-----|---------|
| 개별 읽음 처리 | O | - |
| 전체 읽음 처리 | **O** | - |
| 알림 삭제 | X | O |
| 알림 설정 | X | O |

### 7.3 푸시 알림 (Phase 2)

| 항목 | 설정 |
|------|------|
| 기술 | FCM (Firebase Cloud Messaging) |
| 대상 이벤트 | 참가 승인/거절, 새 참가 신청, 경기 임박, 경기 취소 |
| 우선순위 | Phase 2 최우선 기능 |

---

## 8. UI/UX 스펙

### 8.1 레이아웃

| 항목 | 설정 |
|------|------|
| 기준 해상도 | 390x844 (iPhone 14 기준) |
| 레이아웃 | 모바일 고정 레이아웃 |
| 데스크톱 | 모바일 뷰 중앙 배치 |

### 8.2 네비게이션

**하단 탭 바**:
| 탭 | 아이콘 | 페이지 |
|----|--------|--------|
| 홈 | 🏠 | 메인 (지도 + 경기 목록) |
| 경기 생성 | ➕ | 경기 생성 폼 |
| 마이페이지 | 👤 | 마이페이지 |

### 8.3 메인 화면 (홈)

**하이브리드 UI**:
```
┌─────────────────────────┐
│      지도 영역 (50%)     │
│  (마커 클릭 → 리스트 이동) │
├─────────────────────────┤
│     경기 목록 (50%)      │
│  (클릭 → 지도 마커 포커스) │
└─────────────────────────┘
```

**양방향 연동**:
- 지도 이동 시 → 해당 영역 경기만 리스트에 표시
- 리스트 항목 클릭 시 → 지도가 해당 위치로 이동

### 8.4 경기 상세 페이지

```
┌─────────────────────────┐
│ 경기 제목                │
│ 호스트: OOO              │
├─────────────────────────┤
│ 📅 날짜/시간             │
│ 📍 장소 (지도 + 길찾기)   │
│ 👥 참가자 N/M명          │
├─────────────────────────┤
│ 참가자 목록              │
│ - 닉네임 ⭐4.5           │
│ - 닉네임 ⭐4.8           │
├─────────────────────────┤
│    [참가 신청 버튼]       │
└─────────────────────────┘
```

**장소 정보**:
- 미니 지도 표시
- 카카오내비 길찾기 버튼

### 8.5 비로그인 사용자 접근

| 페이지 | 접근 가능 |
|--------|----------|
| 경기 목록 (홈) | **O** |
| 경기 상세 | **O** |
| 참가 신청 | X (로그인 필요) |
| 경기 생성 | X (로그인 필요) |
| 마이페이지 | X (로그인 필요) |

---

## 9. Phase 구분

### Phase 1: MVP (현재)

**포함 기능**:
- [x] 카카오 로그인/회원가입
- [x] 경기 CRUD (생성, 조회, 수정, 취소)
- [x] 경기 복구 (취소 후 1시간 이내)
- [x] 참가 신청/취소/승인/거절
- [x] 장소 등록/조회
- [x] 알림 (서버 저장, 폴링 조회)
- [x] 마이페이지 (프로필, 내 경기)
- [x] 취소 시간 제한 (호스트/참가자 2시간 전)
- [x] 취소 사유 필수 (호스트)
- [x] 중복 참가/호스팅 제한 (시간 겹침)
- [x] 경기 생성 시간 제한 (1시간 후 ~ 14일)
- [x] 인원 제한 (4-20명)
- [ ] 종료된 경기 7일 후 숨김
- [ ] 전체 알림 읽음 처리
- [ ] 프로필 수정 (닉네임, 사진, 소개)

### Phase 2: 사용자 경험 개선

**우선순위 순**:
1. **푸시 알림 (FCM)** - 최우선
2. 평점/리뷰 시스템
3. 실력 레벨 시스템
4. 검색/필터링 (날짜, 시간대, 거리)
5. 회원 탈퇴

### Phase 3: 확장

- 실시간 채팅
- 팀 매칭
- 정기 경기 (반복)
- 결제 (유료 경기)

---

## 10. API 엔드포인트 요약

### 인증 (Auth)
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/auth/kakao` | 카카오 인증 URL |
| GET | `/api/auth/kakao/callback` | 카카오 콜백 |
| POST | `/api/auth/signup` | 회원가입 |
| POST | `/api/auth/refresh` | 토큰 갱신 |

### 경기 (Match)
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/matches` | 경기 생성 |
| GET | `/api/matches` | 경기 목록 조회 |
| GET | `/api/matches/{id}` | 경기 상세 조회 |
| PUT | `/api/matches/{id}` | 경기 수정 (제목/설명만) |
| DELETE | `/api/matches/{id}` | 경기 취소 |
| POST | `/api/matches/{id}/reactivate` | 경기 복구 |
| GET | `/api/matches/hosted` | 내가 호스팅한 경기 |

### 참가 (Participation)
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/matches/{id}/participations` | 참가 신청 |
| DELETE | `/api/matches/{id}/participations/{pid}` | 참가 취소 |
| PUT | `/api/matches/{id}/participations/{pid}/approve` | 참가 승인 |
| PUT | `/api/matches/{id}/participations/{pid}/reject` | 참가 거절 |
| GET | `/api/matches/{id}/participants` | 참가자 목록 |

### 사용자 (User)
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/users/me` | 내 정보 조회 |
| PUT | `/api/users/me` | 내 정보 수정 |
| GET | `/api/users/me/participations` | 내 참가 경기 |
| GET | `/api/users/{id}` | 사용자 프로필 조회 |

### 장소 (Location)
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/locations` | 장소 등록 |
| GET | `/api/locations` | 장소 목록 |
| GET | `/api/locations/search` | 장소 검색 |
| GET | `/api/locations/{id}` | 장소 상세 |

### 알림 (Notification)
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/notifications` | 알림 목록 |
| PUT | `/api/notifications/{id}/read` | 개별 읽음 처리 |
| PUT | `/api/notifications/read-all` | 전체 읽음 처리 (신규) |
| GET | `/api/notifications/unread-count` | 읽지 않은 개수 |

---

## 11. 구현 필요 항목 (Gap Analysis)

현재 구현 상태와 본 스펙의 차이:

### 완료된 항목 (P0)

| 기능 | 우선순위 | 상태 |
|------|----------|--------|
| 취소 시간 제한 (호스트/참가자 2시간 전) | P0 | ✅ 완료 |
| 호스트 취소 시 사유 필수 | P0 | ✅ 완료 |
| 중복 참가 제한 (시간 겹침 체크) | P0 | ✅ 완료 |
| 중복 호스팅 제한 (시간 겹침 체크) | P0 | ✅ 완료 |
| 경기 생성 시간 제한 (1시간 후 ~ 14일) | P0 | ✅ 완료 |
| 인원 제한 (4-20명) | P0 | ✅ 완료 |

### 신규 구현 필요

| 기능 | 우선순위 | 복잡도 |
|------|----------|--------|
| 종료된 경기 7일 후 숨김 | P1 | 낮음 |
| 전체 알림 읽음 처리 API | P1 | 낮음 |
| 프로필 수정 (bio 필드 추가) | P1 | 낮음 |
| 하단 네비게이션 바 | P1 | 중간 |
| 지도-리스트 양방향 연동 | P2 | 높음 |

### 기존 구현 확인 필요

| 기능 | 현재 상태 | 확인 필요 |
|------|----------|----------|
| 경기 수정 | 구현됨 | 제목/설명만 수정 가능한지 확인 |
| 프로필 수정 | 구현됨 | 닉네임/사진 수정 가능한지 확인 |
| 낙관적 락 | 구현됨 | 3회 재시도 동작 확인 |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2026-01-13 | 최초 작성 (인터뷰 기반) | Claude |
