# 상태 다이어그램 (State Diagrams)

> 이 문서는 **경기와 신청의 상태 전환 흐름**을 시각화합니다.

---

## Match Context - 경기 상태 흐름

### Match Status 전체 다이어그램

```
┌─────────────────────────────────────────────────────┐
│                  경기 생성                           │
│              Host가 경기 만들기                     │
└────────────────┬────────────────────────────────────┘
                 │
                 ▼
        ┌────────────────────┐
        │    RECRUITING      │
        │   (모집 중)        │
        │                    │
        │  • 신청 가능       │
        │  • 인원 부족       │
        │  • Host 이미 포함  │
        └────────┬───────────┘
                 │
                 │ 조건: 신청자가 n명을 채움
                 │
                 ▼
        ┌────────────────────┐
        │   CONFIRMED        │
        │   (확정됨)         │
        │                    │
        │  • 신청 불가       │
        │  • n명 모두 확정   │
        │  • 경기 시작 준비  │
        └────────┬───────────┘
                 │
                 │ 조건: 경기 시간이 지남
                 │
                 ▼
        ┌────────────────────┐
        │   COMPLETED        │
        │   (완료됨)         │
        │                    │
        │  • 경기 종료       │
        │  • 평가 가능       │
        │  • 최종 상태       │
        └────────────────────┘


    또는 언제든 (RECRUITING/CONFIRMED 상태에서):
    ┌────────────────────┐
    │   CANCELLED        │
    │   (취소됨)         │
    │                    │
    │  • Host가 취소     │
    │  • 모든 신청 취소  │
    │  • 최종 상태       │
    └────────────────────┘
```

### Match Status 상태별 설명

#### **1. RECRUITING (모집 중)**

```
Host가 경기를 생성한 후의 초기 상태

참여자: Host 1명 + 신청자 (아직 부족)

가능한 행동:
  ✓ 신청자들이 경기에 신청 가능
  ✓ Host가 신청자 수락/거절 (구현 여부에 따라)
  ✗ 신청 불가능한 사람: 신뢰도 낮은 사용자

상태 전환 조건:
  → CONFIRMED: 신청자가 (n-1)명을 채우면 자동 전환
  → CANCELLED: Host가 경기 취소
```

#### **2. CONFIRMED (확정됨)**

```
경기 정원 n명이 모두 모인 상태

참여자: Host 1명 + 신청자 (n-1)명 = 총 n명

가능한 행동:
  ✓ 경기 진행 준비
  ✓ 경기 시작 알림 발송
  ✗ 더 이상 신청 불가능
  ✗ 신청자 추가 불가능

상태 전환 조건:
  → COMPLETED: 경기 시간이 지나면 자동 전환
  → CANCELLED: Host가 경기 취소
```

#### **3. COMPLETED (완료됨)**

```
경기 시간이 지나 끝난 상태 (최종 상태)

가능한 행동:
  ✓ 참여자들이 서로 평가/리뷰 작성
  ✓ 신뢰도 점수 계산

상태 전환:
  → 더 이상 상태 변경 없음 (최종 상태)
```

#### **4. CANCELLED (취소됨)**

```
Host가 경기를 취소한 상태 (최종 상태)

취소되는 경우:
  • Host가 명시적으로 취소
  • 기술적 오류로 취소

영향:
  ✗ 모든 신청 자동 취소
  ✗ 참여자들에게 취소 알림 발송

상태 전환:
  → 더 이상 상태 변경 없음 (최종 상태)
```

---

## Participation Context - 신청 상태 흐름

### Participation Status 전체 다이어그램

```
┌─────────────────────────────────────────────────────┐
│              사용자가 신청                          │
│         "이 경기에 신청하기" 클릭                  │
└────────────────┬────────────────────────────────────┘
                 │
                 ▼
        ┌────────────────────┐
        │ PENDING_APPROVAL   │
        │  (승인 대기)       │
        │                    │
        │  • Host에게 알림   │
        │  • 승인 대기 중    │
        │  • 취소 가능       │
        └────────┬───────────┘
                 │
         ┌───────┴───────┐
         │               │
    Host 승인      Host 거부
         │               │
         ▼               ▼
    ┌─────────┐   ┌──────────┐
    │APPROVED │   │ REJECTED │
    │(승인됨) │   │ (거부됨) │
    │         │   │          │
    │• 승인됨 │   │• 참여불가│
    │• 취소가능│   │• 최종상태│
    └────┬────┘   └──────────┘
         │
         │ 조건: Host가 n명 승인
         │
         ▼
    ┌────────────────────┐
    │   CONFIRMED        │
    │   (확정됨)         │
    │                    │
    │  • 모두에게 알림   │
    │  • 경기 진행 준비  │
    │  • 취소 가능       │
    └────────┬───────────┘
             │
             │ 조건: 경기 시간이 지남
             │
     ┌───────┴───────┐
     │               │
     │ 참석 여부     │
     │
참석했음    참석하지 않음
     │       │
     ▼       ▼
┌─────────┐ ┌──────────┐
│COMPLETED│ │ NO_SHOW  │
│(완료됨) │ │ (노쇼)   │
│         │ │          │
│신뢰도   │ │신뢰도   │
│유지/상향 │ │-0.5점   │
└─────────┘ └──────────┘


    또는 언제든 (PENDING_APPROVAL/APPROVED/CONFIRMED 상태에서):
    ┌────────────────────┐
    │   CANCELLED        │
    │   (취소됨)         │
    │                    │
    │  • 사용자 취소     │
    │  • 경기 취소       │
    │  • 최종 상태       │
    └────────────────────┘
```

### Participation Status 상태별 설명

#### **1. PENDING_APPROVAL (승인 대기)**

```
사용자가 경기에 신청한 직후 상태

신청 조건:
  ✓ 경기 상태 = RECRUITING
  ✓ 신뢰도 >= 2.0
  ✓ 같은 경기 중복 신청 안 함
  ✓ 겹치는 시간에 다른 신청 없음

상태:
  • Host에게 신청 알림 발송
  • Host의 승인/거부 대기 중
  • 다른 참여자들은 알림 안 받음
  • 신청자는 취소 가능

상태 전환 조건:
  → APPROVED: Host가 승인
  → REJECTED: Host가 거부
  → CANCELLED: 사용자가 신청 취소 또는 경기 취소
```

#### **2. APPROVED (승인됨)**

```
Host가 신청을 승인한 상태

전환 방식:
  Host가 "승인" 버튼 클릭
    ↓
  PENDING_APPROVAL → APPROVED

상태:
  • 신청자에게 "승인됨" 알림 발송
  • 경기 참여 자격 획득
  • 아직 경기 확정 전 (n명 승인 대기)
  • 취소 가능

상태 전환 조건:
  → CONFIRMED: Host가 총 n명을 승인하면 자동 전환
  → CANCELLED: 사용자가 신청 취소 또는 경기 취소
```

#### **3. REJECTED (거부됨)**

```
Host가 신청을 거부한 상태 (최종 상태)

전환 방식:
  Host가 "거부" 버튼 클릭
    ↓
  PENDING_APPROVAL → REJECTED

상태:
  • 신청자에게 "거부됨" 알림 발송 (선택적)
  • 경기 참여 불가
  • 신뢰도 영향 없음

상태 전환:
  → 더 이상 상태 변경 없음 (최종 상태)
```

#### **4. CONFIRMED (확정됨)**

```
경기 정원이 가득 차서 경기가 확정된 상태

전환 방식:
  Host가 n명 승인 완료
    ↓
  경기 상태: RECRUITING → CONFIRMED
    ↓ (자동 연쇄)
  신청 상태: APPROVED → CONFIRMED (승인된 모든 신청)

상태:
  • 모든 참여자에게 "경기 확정" 알림
  • 경기 시간 1시간 전 "시작 1시간 전" 알림
  • 경기 진행 준비

상태 전환 조건:
  → COMPLETED: 경기가 끝나고 참석했음
  → NO_SHOW: 경기가 끝났는데 참석하지 않음
  → CANCELLED: 사용자가 신청 취소 또는 경기 취소
```

#### **5. COMPLETED (완료됨)**

```
경기가 정상적으로 끝나고 사용자가 참석한 상태 (최종 상태)

조건:
  • 경기 시간이 지남
  • 사용자가 경기에 참석함

결과:
  ✓ 신뢰도 유지 또는 상향 (+0.2 ~ +0.3)
  ✓ 상대방 평가 가능
  ✓ 리뷰 작성 가능

상태 전환:
  → 더 이상 상태 변경 없음 (최종 상태)
```

#### **6. NO_SHOW (노쇼)**

```
경기가 끝났는데 사용자가 참석하지 않은 상태 (최종 상태)

조건:
  • 경기 상태 = CONFIRMED (확정됨)
  • 경기 시간이 지남
  • 사용자가 참석하지 않음

결과:
  ✗ 신뢰도 감소 (-0.5점) (심각함)
  ✗ 노쇼 기록 누적
  ✗ 노쇼 3회 이상 → 자동 정지
  ✓ 상대방 평가는 안 함 (참석하지 않았으므로)

상태 전환:
  → 더 이상 상태 변경 없음 (최종 상태)
```

#### **7. CANCELLED (취소됨)**

```
신청을 취소하거나 경기 자체가 취소된 상태 (최종 상태)

취소되는 경우:
  • 사용자가 신청 취소
  • Host가 경기 취소 (모든 신청 자동 취소)

결과:
  • 신뢰도 영향 없음 (취소했으므로)
  • 참여 기록 남음 (통계용)

상태 전환:
  → 더 이상 상태 변경 없음 (최종 상태)
```

---

## 상태 전환 표 (한눈에 보기)

### Match Status 전환 표

| 현재 상태 | 다음 상태 | 조건 | 자동/수동 |
|---------|---------|------|---------|
| RECRUITING | CONFIRMED | 신청자가 (n-1)명을 채움 | 자동 |
| RECRUITING | CANCELLED | Host가 경기 취소 | 수동 |
| CONFIRMED | COMPLETED | 경기 시간이 지남 | 자동 |
| CONFIRMED | CANCELLED | Host가 경기 취소 | 수동 |
| COMPLETED | - | 최종 상태 | - |
| CANCELLED | - | 최종 상태 | - |

### Participation Status 전환 표

| 현재 상태 | 다음 상태 | 조건 | 자동/수동 |
|---------|---------|------|---------|
| PENDING_APPROVAL | APPROVED | Host가 승인 | 수동 |
| PENDING_APPROVAL | REJECTED | Host가 거부 | 수동 |
| PENDING_APPROVAL | CANCELLED | 사용자 취소 또는 경기 취소 | 수동 |
| APPROVED | CONFIRMED | Host가 n명 승인 완료 (경기 CONFIRMED) | 자동 |
| APPROVED | CANCELLED | 사용자 취소 또는 경기 취소 | 수동 |
| CONFIRMED | COMPLETED | 경기 시간 경과 + 참석 | 자동 |
| CONFIRMED | NO_SHOW | 경기 시간 경과 + 미참석 | 자동 |
| CONFIRMED | CANCELLED | 사용자 취소 또는 경기 취소 | 수동 |
| REJECTED | - | 최종 상태 | - |
| COMPLETED | - | 최종 상태 | - |
| NO_SHOW | - | 최종 상태 | - |
| CANCELLED | - | 최종 상태 | - |

---

## Match와 Participation 상태 동기화

### 경기가 CONFIRMED되면 신청도 자동 CONFIRMED

```
Host가 n명 승인 완료:
  신청 상태: APPROVED (n명)
    ↓ (자동 트리거)
  경기 상태: RECRUITING → CONFIRMED
    ↓ (자동 연쇄)
  신청 상태: APPROVED → CONFIRMED (승인된 모든 신청)

결과:
  모든 참여자에게 "경기 확정" 알림 발송
```

### 경기가 CANCELLED되면 신청도 자동 CANCELLED

```
경기 상태 변경:
  RECRUITING/CONFIRMED → CANCELLED

영향받는 신청들:
  PENDING_APPROVAL/APPROVED/CONFIRMED 상태인 모든 신청
    ↓ (자동)
  CANCELLED 상태로 변경

결과:
  모든 신청자 및 참여자에게 "경기 취소" 알림 발송
```

---

**상태 다이어그램은 코드 구현의 기초입니다. 반드시 이 규칙대로 구현해야 합니다.**